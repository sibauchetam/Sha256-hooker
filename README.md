# XposedDigest - LSPosed Module

XposedDigest is an LSPosed module designed to intercept and log the formation chain of the `x-digest` HTTP header in a target Android application. It helps developers and security researchers understand how the signature is generated, making it possible to reproduce it for unofficial clients or security analysis.

## Features

- **Dynamic Hooking:** Intercepts cryptography and network calls in real-time.
- **Targeted Application:** Hooks are activated only for a specific target application (configurable, defaults to `com.schools_by.app_parent`).
- **Configurable Hooks:** Crypto and network hooks can be enabled or disabled individually through a settings UI.
- **Detailed Logging:** Captures the algorithm, key material, input data, and final signature.
- **Stack Trace Analysis:** Logs the stack trace when the `x-digest` header is added to a network request, pinpointing the exact location in the code.
- **Structured Logging:** Outputs logs in NDJSON format to logcat for easy parsing and analysis.

## How It Works

The module uses the LSPosed framework to inject code into the target application at runtime. It hooks into two main areas:

1.  **Cryptography APIs (`java.security.MessageDigest`, `javax.crypto.Mac`):** Intercepts hashing and signing operations. It logs the algorithm used, the key (if available), the raw input bytes, and the resulting digest/signature.
2.  **Network APIs (`OkHttp`, `HttpURLConnection`):** Intercepts the creation of network requests. When it detects the `x-digest` header, it logs the request details (URL, method) and a full stack trace to identify the code responsible for adding the header.

## Installation

1.  **Prerequisites:**
    *   An Android device with LSPosed framework installed and activated.
2.  **Installation:**
    *   Download the latest release APK from the [Releases](../../releases) page.
    *   Install the APK on your device.
    *   Open the LSPosed manager app.
    *   Activate the **XposedDigest** module.
    *   Select the target application(s) for the module. By default, it is designed for `com.schools_by.app_parent`, but you can enable it for any app you wish to analyze.
    *   Reboot your device to apply the changes.

## Usage

1.  **Configure Hooks:**
    *   Open the **XposedDigest** app from your launcher.
    *   Use the switches to enable or disable **Crypto Hooks** and **Network Hooks**. Changes are saved automatically.
    *   By default, both are enabled.

2.  **View Logs:**
    *   Use `logcat` to view the logs generated by the module. You can filter by the tag `XposedDigest`.
    *   Example command: `adb logcat -s XposedDigest`
    *   The logs are in NDJSON format, meaning each line is a self-contained JSON object.

## Log Format (NDJSON)

Each log entry is a JSON object with the following structure:

```json
{
  "timestamp": "2023-10-27T10:30:00.123Z",
  "hookType": "crypto" | "network",
  "event": "Mac.init" | "MessageDigest.digest" | "Network.HeaderFound",
  /* Crypto-specific fields */
  "algorithm": "HmacSHA256",
  "keyHex": "aabbcc...",
  "inputHex": "ddeeff...",
  "inputUtf8": "some string",
  "outputHex": "112233...",
  /* Network-specific fields */
  "url": "https://api.example.com/data",
  "method": "POST",
  "header": "x-digest: 112233...",
  "stackTrace": "..."
}
```

## Building from Source

1.  Clone the repository.
2.  Open the project in Android Studio.
3.  The project uses Gradle. It will sync and download the necessary dependencies.
4.  To build the APK, run the following command in the project's root directory:
    ```bash
    ./gradlew assembleRelease
    ```
5.  The unsigned APK will be located in `app/build/outputs/apk/release/`.

---
*This module is for educational and research purposes only.*